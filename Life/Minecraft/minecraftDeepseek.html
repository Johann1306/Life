<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Web - Version Simplifiée</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #87CEEB;
            font-family: Arial, sans-serif;
        }
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            z-index: 100;
        }
        #crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            z-index: 99;
        }
        #crosshair::before, #crosshair::after {
            content: '';
            position: absolute;
            background-color: white;
        }
        #crosshair::before {
            width: 2px;
            height: 20px;
            left: 9px;
            top: 0;
        }
        #crosshair::after {
            width: 20px;
            height: 2px;
            left: 0;
            top: 9px;
        }
        #inventory {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 5px;
            border-radius: 5px;
            z-index: 100;
        }
        .inventory-slot {
            width: 40px;
            height: 40px;
            margin: 0 5px;
            border: 2px solid #555;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.3);
        }
        .inventory-slot.active {
            border-color: white;
        }
        .block-preview {
            width: 30px;
            height: 30px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="info">
            <div>Minecraft Web - Version Simplifiée</div>
            <div>Déplacements: ZQSD | Sauter: Espace | Casser: Clic gauche | Placer: Clic droit</div>
            <div>Changer de bloc: 1-6 | Inventaire: E</div>
        </div>
        <div id="crosshair"></div>
        <div id="inventory">
            <div class="inventory-slot active" data-block="grass">
                <div class="block-preview" style="background-color: #5a8c49;"></div>
            </div>
            <div class="inventory-slot" data-block="dirt">
                <div class="block-preview" style="background-color: #8c6e4a;"></div>
            </div>
            <div class="inventory-slot" data-block="stone">
                <div class="block-preview" style="background-color: #7f7f7f;"></div>
            </div>
            <div class="inventory-slot" data-block="wood">
                <div class="block-preview" style="background-color: #8c6e4a;"></div>
            </div>
            <div class="inventory-slot" data-block="sand">
                <div class="block-preview" style="background-color: #e3c78c;"></div>
            </div>
            <div class="inventory-slot" data-block="water">
                <div class="block-preview" style="background-color: #4a7c9c;"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Variables globales
        let scene, camera, renderer;
        let world = {};
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();
        let selectedBlock = null;
        let currentBlockType = 'grass';
        let keys = {};
        let player = {
            position: new THREE.Vector3(0, 10, 0),
            velocity: new THREE.Vector3(0, 0, 0),
            onGround: false,
            height: 1.8
        };

        // Initialisation
        function init() {
            // Créer la scène
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            
            // Créer la caméra
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(player.position.x, player.position.y + player.height, player.position.z);
            
            // Créer le rendu
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('gameContainer').appendChild(renderer.domElement);
            
            // Ajouter la lumière
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(100, 100, 50);
            scene.add(directionalLight);
            
            // Générer le monde
            generateWorld();
            
            // Événements
            window.addEventListener('resize', onWindowResize);
            document.addEventListener('keydown', onKeyDown);
            document.addEventListener('keyup', onKeyUp);
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('click', onMouseClick);
            
            // Démarrer la boucle d'animation
            animate();
        }

        // Générer le monde
        function generateWorld() {
            // Créer le sol
            for (let x = -20; x <= 20; x++) {
                for (let z = -20; z <= 20; z++) {
                    // Hauteur du terrain (simulation simple)
                    let height = Math.floor(Math.sin(x * 0.2) * Math.cos(z * 0.2) * 3);
                    
                    // Placer des blocs de terre
                    for (let y = 0; y <= height; y++) {
                        placeBlock(x, y, z, 'dirt');
                    }
                    
                    // Placer de l'herbe sur le dessus
                    if (height >= 0) {
                        placeBlock(x, height + 1, z, 'grass');
                    }
                    
                    // Ajouter quelques arbres
                    if (Math.random() < 0.02 && height >= 0) {
                        // Tronc
                        for (let y = height + 2; y < height + 6; y++) {
                            placeBlock(x, y, z, 'wood');
                        }
                        
                        // Feuilles
                        for (let dx = -2; dx <= 2; dx++) {
                            for (let dz = -2; dz <= 2; dz++) {
                                for (let dy = 0; dy <= 2; dy++) {
                                    if (Math.abs(dx) + Math.abs(dz) + Math.abs(dy) <= 3) {
                                        placeBlock(x + dx, height + 6 + dy, z + dz, 'grass');
                                    }
                                }
                            }
                        }
                    }
                    
                    // Ajouter de l'eau dans les creux
                    if (height < 0) {
                        for (let y = 0; y > height; y--) {
                            placeBlock(x, y, z, 'water');
                        }
                    }
                }
            }
        }

        // Placer un bloc
        function placeBlock(x, y, z, type) {
            const key = `${x},${y},${z}`;
            
            // Supprimer le bloc existant s'il y en a un
            if (world[key]) {
                scene.remove(world[key]);
                delete world[key];
            }
            
            // Créer un nouveau bloc
            let geometry = new THREE.BoxGeometry(1, 1, 1);
            let material;
            
            switch(type) {
                case 'grass':
                    material = new THREE.MeshLambertMaterial({ color: 0x5a8c49 });
                    break;
                case 'dirt':
                    material = new THREE.MeshLambertMaterial({ color: 0x8c6e4a });
                    break;
                case 'stone':
                    material = new THREE.MeshLambertMaterial({ color: 0x7f7f7f });
                    break;
                case 'wood':
                    material = new THREE.MeshLambertMaterial({ color: 0x8c6e4a });
                    break;
                case 'sand':
                    material = new THREE.MeshLambertMaterial({ color: 0xe3c78c });
                    break;
                case 'water':
                    material = new THREE.MeshLambertMaterial({ 
                        color: 0x4a7c9c,
                        transparent: true,
                        opacity: 0.7
                    });
                    break;
                default:
                    material = new THREE.MeshLambertMaterial({ color: 0xffffff });
            }
            
            let block = new THREE.Mesh(geometry, material);
            block.position.set(x, y, z);
            block.userData = { type: type, x: x, y: y, z: z };
            scene.add(block);
            world[key] = block;
            
            return block;
        }

        // Obtenir un bloc à une position donnée
        function getBlock(x, y, z) {
            const key = `${Math.floor(x)},${Math.floor(y)},${Math.floor(z)}`;
            return world[key];
        }

        // Mise à jour de la taille de la fenêtre
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Gestion des touches enfoncées
        function onKeyDown(event) {
            keys[event.code] = true;
            
            // Changer de type de bloc avec les touches 1-6
            if (event.code >= 'Digit1' && event.code <= 'Digit6') {
                const index = parseInt(event.code.replace('Digit', '')) - 1;
                const slots = document.querySelectorAll('.inventory-slot');
                slots.forEach(slot => slot.classList.remove('active'));
                slots[index].classList.add('active');
                currentBlockType = slots[index].dataset.block;
            }
        }

        // Gestion des touches relâchées
        function onKeyUp(event) {
            keys[event.code] = false;
        }

        // Gestion du mouvement de la souris
        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        }

        // Gestion des clics de souris
        function onMouseClick(event) {
            if (selectedBlock) {
                const blockPos = selectedBlock.position;
                
                if (event.button === 0) { // Clic gauche - casser
                    placeBlock(blockPos.x, blockPos.y, blockPos.z, null);
                } else if (event.button === 2) { // Clic droit - placer
                    // Calculer la position où placer le nouveau bloc
                    const normal = selectedBlock.userData.normal;
                    const newX = blockPos.x + normal.x;
                    const newY = blockPos.y + normal.y;
                    const newZ = blockPos.z + normal.z;
                    
                    // Vérifier que la position n'est pas occupée
                    if (!getBlock(newX, newY, newZ)) {
                        placeBlock(newX, newY, newZ, currentBlockType);
                    }
                }
            }
            
            // Empêcher le menu contextuel
            event.preventDefault();
        }

        // Mise à jour du joueur
        function updatePlayer(deltaTime) {
            // Appliquer la gravité
            player.velocity.y -= 20 * deltaTime;
            
            // Vérifier la collision avec le sol
            const feetY = player.position.y;
            const headY = player.position.y + player.height;
            
            // Vérifier si le joueur touche le sol
            player.onGround = false;
            for (let x = -0.3; x <= 0.3; x += 0.3) {
                for (let z = -0.3; z <= 0.3; z += 0.3) {
                    if (getBlock(player.position.x + x, feetY - 0.1, player.position.z + z)) {
                        player.onGround = true;
                        player.velocity.y = Math.max(0, player.velocity.y);
                        player.position.y = Math.floor(feetY) + 0.1;
                    }
                }
            }
            
            // Sauter
            if (keys['Space'] && player.onGround) {
                player.velocity.y = 10;
            }
            
            // Déplacements
            const moveSpeed = 10;
            const moveVector = new THREE.Vector3();
            
            if (keys['KeyZ'] || keys['ArrowUp']) moveVector.z -= 1;
            if (keys['KeyS'] || keys['ArrowDown']) moveVector.z += 1;
            if (keys['KeyQ'] || keys['ArrowLeft']) moveVector.x -= 1;
            if (keys['KeyD'] || keys['ArrowRight']) moveVector.x += 1;
            
            moveVector.normalize();
            moveVector.multiplyScalar(moveSpeed * deltaTime);
            
            // Rotation du vecteur de mouvement en fonction de l'orientation de la caméra
            moveVector.applyEuler(camera.rotation);
            
            player.velocity.x = moveVector.x;
            player.velocity.z = moveVector.z;
            
            // Appliquer la vélocité
            player.position.add(player.velocity.clone().multiplyScalar(deltaTime));
            
            // Mettre à jour la position de la caméra
            camera.position.set(
                player.position.x,
                player.position.y + player.height,
                player.position.z
            );
        }

        // Animation
        function animate() {
            requestAnimationFrame(animate);
            
            // Calculer le temps écoulé depuis la dernière frame
            const deltaTime = 0.016; // Approximation pour 60 FPS
            
            // Mettre à jour le joueur
            updatePlayer(deltaTime);
            
            // Mettre à jour le rayon de sélection
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(Object.values(world));
            
            // Réinitialiser la sélection précédente
            if (selectedBlock) {
                selectedBlock.material.emissive.setHex(selectedBlock.userData.originalEmissive || 0x000000);
                selectedBlock = null;
            }
            
            // Mettre à jour la sélection actuelle
            if (intersects.length > 0) {
                selectedBlock = intersects[0].object;
                selectedBlock.userData.originalEmissive = selectedBlock.material.emissive.getHex();
                selectedBlock.material.emissive.setHex(0x444444);
                selectedBlock.userData.normal = intersects[0].face.normal;
            }
            
            // Rendu
            renderer.render(scene, camera);
        }

        // Démarrer le jeu
        init();
    </script>
</body>
</html>